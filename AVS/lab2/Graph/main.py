import pandas as pd
import matplotlib.pyplot as plt
from io import StringIO

# Функция для создания и отображения графиков
def create_overlay_graphs(data_gpu, data_cpu_nostm, data_cpu_stm):
    # Создаем DataFrame для каждого набора данных
    df_gpu = pd.read_csv(StringIO(data_gpu), sep=';')
    df_cpu_nostm = pd.read_csv(StringIO(data_cpu_nostm), sep=';')
    df_cpu_stm = pd.read_csv(StringIO(data_cpu_stm), sep=';')

    # Создаем фигуру и оси для графика
    plt.figure(figsize=(10, 5))

    # График для GPU
    plt.plot(df_gpu['diapazon'], df_gpu['time'], marker='o', color='red', label='GPU')

    # График для CPU без SMT
    plt.plot(df_cpu_nostm['diapazon'], df_cpu_nostm['time'], marker='x', color='green', label='CPU_NO_SMT')

    # График для CPU с SMT
    plt.plot(df_cpu_stm['diapazon'], df_cpu_stm['time'], marker='^', color='blue', label='CPU_SMT')

    # Добавляем легенду и заголовок
    plt.legend()
    plt.title('Сравнение производительности')
    plt.xlabel('STEP')
    plt.ylabel('TIME(ms)')
    plt.grid(True)

    # Сохраняем график и отображаем его
    plt.savefig('overlay_graph.png')
    plt.show()

# Ваши данные для GPU
data_gpu = """
diapazon;time
110;4.09752
120;12.2205
130;14.6447
140;24.359
150;33.4503
160;36.6487
170;37.6655
180;48.7191
190;59.2799
200;66.4458
210;63.0347
220;75.5185
230;58.3045
240;78.9081
250;93.8997
260;83.4433
270;77.7262
280;100.306
290;77.036
300;99.9708
310;91.2037
320;94.216
330;108.509
340;113.346
350;117.667
360;111.616
370;124.967
380;120.444
390;168.814
400;141.733
410;180.101
420;138.068
430;141.9
440;264.597
450;166.048
460;171.021
470;251.813
480;297.508
490;300.779
500;189.268
"""

# Ваши данные для CPU без SMT
data_cpu_nostm = """    
diapazon;time
110;370.597
120;156.39
130;200.424
140;274.887
150;423.754
160;557.711
170;938.661
180;726.375
190;1165.86
200;959.671
210;889.48
220;2323.52
230;1526.51
240;2133.29
250;3126.7
260;1586.46
270;1851.23
280;1690.49
290;1432.06
300;1570.47
310;2021.62
320;2367.17
330;1755.29
340;2248.74
350;3857.35
360;1954.13
370;2187.79
380;2771.84
390;3660.76
400;3071.08
410;3114.94
420;2073.96
430;3667.12
440;2826.4
450;2979.03
460;3288.55
470;3211.24
480;3683
490;3046.54
500;2962.84
"""

# Ваши данные для CPU с SMT
data_cpu_stm = """
diapazon;time
110;118.035
120;74.7732
130;101.924
140;140.83
150;134.713
160;259.982
170;202.477
180;497.43
190;1061.53
200;604.348
210;460.86
220;319.162
230;994.205
240;381.381
250;414.821
260;656.777
270;472.566
280;485.793
290;532.316
300;828.958
310;554.167
320;997.044
330;676.448
340;995.576
350;789.133
360;653.561
370;709.37
380;792.213
390;1029.64
400;1504.85
410;991.891
420;1076.99
430;869.81
440;1427.77
450;1181.74
460;991.759
470;1199.23
480;1629.2
490;1371.98
500;1260.09
"""

# Вызываем функцию с данными
create_overlay_graphs(data_gpu, data_cpu_nostm, data_cpu_stm)
